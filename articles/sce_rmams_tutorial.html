<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rmams">
<title>Creating MAMS from SingleCellExperiment â€¢ rmams</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Creating MAMS from SingleCellExperiment">
<meta property="og:description" content="rmams">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rmams</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/annData_rmams_tutorial.html">Creating MAMS from AnnData</a>
    <a class="dropdown-item" href="../articles/rmams_tutorial.html">Creating MAMS from Seurat</a>
    <a class="dropdown-item" href="../articles/sce_rmams_tutorial.html">Creating MAMS from SingleCellExperiment</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Creating MAMS from SingleCellExperiment</h1>
            
            <h4 data-toc-skip class="date">2024-05-30</h4>
      
      
      <div class="d-none name"><code>sce_rmams_tutorial.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Matrix and Analysis Metadata Standards (MAMS) can be used to capture
the relevant information about the data matrices and annotations that
are produced during common and complex analysis workflows for
single-cell data.</p>
<p>This workflow highlights how an RNA expression based experiment from
a SingleCellExperiment object can be annotated using the rmams package.
For this purpose, we will analyze the <a href="https://support.10xgenomics.com/single-cell-gene-expression/datasets/4.0.0/SC3_v3_NextGem_SI_PBMC_CSP_1K" class="external-link">PBMC
1K dataset</a> using packages from Bioconductor and with
SingleCellExperiment as our data-container.</p>
<p>The steps include: 1. Importing the raw/droplet and filtered/cell
matrices 2. Performing quality control and further subsetting the
filtered matrix to only include high-quality cells 3. Clustering all
cells 4. Clustering T-cells only</p>
<p>This workflow demonstrates how different subsets of
cells/observations are produced due to QC/filtering or can be made based
on different biological subsets. Note that the goal of this workflow is
less about producing the best clustering results and cell type
characterization. Rather it is focused on producing data/results that is
commonly generated during real-world analyses which can be annotated
with MAMS. For more information about MAMS, see the <a href="https://github.com/single-cell-mams/mams" class="external-link">GitHub
repository</a></p>
<div class="section level3">
<h3 id="step-1-creating-the-singlecellexperiment-object">Step 1: Creating the SingleCellExperiment object<a class="anchor" aria-label="anchor" href="#step-1-creating-the-singlecellexperiment-object"></a>
</h3>
<div class="section level4">
<h4 id="importing">Importing<a class="anchor" aria-label="anchor" href="#importing"></a>
</h4>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SingleCellExperiment</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">DropletUtils</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://bioconductor.org/packages/scater/" class="external-link">scater</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">scran</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/AnnotationDbi" class="external-link">AnnotationDbi</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">org.Hs.eg.db</span><span class="op">)</span></span></code></pre></div>
<p>First, we will import raw/droplet and filtered/cell matrices:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sce.raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DropletUtils/man/read10xCounts.html" class="external-link">read10xCounts</a></span><span class="op">(</span><span class="st">"../data/raw_feature_bc_matrix/"</span><span class="op">)</span></span>
<span><span class="va">sce.filtered</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DropletUtils/man/read10xCounts.html" class="external-link">read10xCounts</a></span><span class="op">(</span><span class="st">"../data/filtered_feature_bc_matrix"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ensembl_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">sce.filtered</span><span class="op">)</span></span>
<span><span class="va">gene_symbols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html" class="external-link">mapIds</a></span><span class="op">(</span><span class="va">org.Hs.eg.db</span>, keys <span class="op">=</span> <span class="va">ensembl_ids</span>, column <span class="op">=</span> <span class="st">"SYMBOL"</span>, keytype <span class="op">=</span> <span class="st">"ENSEMBL"</span>, multiVals <span class="op">=</span> <span class="st">"first"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'select()' returned 1:many mapping between keys and columns</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">sce.filtered</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">gene_symbols</span><span class="op">)</span>, <span class="va">ensembl_ids</span>, <span class="va">gene_symbols</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="quality-control">Quality control<a class="anchor" aria-label="anchor" href="#quality-control"></a>
</h4>
<p>The filtered matrix will be further subsetted based on mitochondrial
percentage:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">is.mito</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"mt-"</span>, <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">sce.filtered</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sce.filtered.nonartifact</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scuttle/man/quickPerCellQC.html" class="external-link">quickPerCellQC</a></span><span class="op">(</span><span class="va">sce.filtered</span>, subsets<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Mito<span class="op">=</span><span class="va">is.mito</span><span class="op">)</span>, sub.fields<span class="op">=</span><span class="st">"subsets_Mito_percent"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="clustering">Clustering<a class="anchor" aria-label="anchor" href="#clustering"></a>
</h4>
<p>The goal of many single cell workflows are to perform clustering to
identify biologically distrinct groups of cells. We will perform
clustering on all QCâ€™ed cells using RNA, ADT, or both and then also
re-cluster the T-cells by themselves.</p>
</div>
<div class="section level4">
<h4 id="analyzing-all-cells">Analyzing all cells<a class="anchor" aria-label="anchor" href="#analyzing-all-cells"></a>
</h4>
<div class="section level5">
<h5 id="rna-only-clustering-of-all-cells">RNA only clustering of all cells<a class="anchor" aria-label="anchor" href="#rna-only-clustering-of-all-cells"></a>
</h5>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sce.filtered.nonartifact</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scuttle/man/logNormCounts.html" class="external-link">logNormCounts</a></span><span class="op">(</span><span class="va">sce.filtered.nonartifact</span><span class="op">)</span></span>
<span><span class="va">dec</span> <span class="op">&lt;-</span> <span class="fu">scran</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scran/man/modelGeneVar.html" class="external-link">modelGeneVar</a></span><span class="op">(</span><span class="va">sce.filtered.nonartifact</span><span class="op">)</span></span>
<span><span class="va">hvgs</span> <span class="op">&lt;-</span> <span class="fu">scran</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scran/man/getTopHVGs.html" class="external-link">getTopHVGs</a></span><span class="op">(</span><span class="va">dec</span>, n <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span>
<span><span class="va">sce.filtered.nonartifact</span> <span class="op">&lt;-</span> <span class="fu">scater</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocSingular/man/runPCA.html" class="external-link">runPCA</a></span><span class="op">(</span><span class="va">sce.filtered.nonartifact</span>, subset_row <span class="op">=</span> <span class="va">hvgs</span><span class="op">)</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu">scran</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scran/man/buildSNNGraph.html" class="external-link">buildSNNGraph</a></span><span class="op">(</span><span class="va">sce.filtered.nonartifact</span>, use.dimred <span class="op">=</span> <span class="st">"PCA"</span><span class="op">)</span></span>
<span><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/cluster_louvain.html" class="external-link">cluster_louvain</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">$</span><span class="va">membership</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/colLabels.html" class="external-link">colLabels</a></span><span class="op">(</span><span class="va">sce.filtered.nonartifact</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span></span>
<span><span class="va">sce.filtered.nonartifact</span> <span class="op">&lt;-</span> <span class="fu">scater</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/runUMAP.html" class="external-link">runUMAP</a></span><span class="op">(</span><span class="va">sce.filtered.nonartifact</span>, dimred <span class="op">=</span> <span class="st">"PCA"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/plot_reddim.html" class="external-link">plotUMAP</a></span><span class="op">(</span><span class="va">sce.filtered.nonartifact</span>, colour_by <span class="op">=</span> <span class="st">"label"</span><span class="op">)</span></span></code></pre></div>
<p><img src="sce_rmams_tutorial_files/figure-html/plot_rna-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/plot_reddim.html" class="external-link">plotUMAP</a></span><span class="op">(</span><span class="va">sce.filtered.nonartifact</span>, colour_by <span class="op">=</span> <span class="st">"CD3E"</span>, by_exprs_values <span class="op">=</span> <span class="st">"logcounts"</span><span class="op">)</span></span></code></pre></div>
<p><img src="sce_rmams_tutorial_files/figure-html/plot_rna_t_cells-1.png" width="700"></p>
</div>
</div>
<div class="section level4">
<h4 id="analysis-of-t-cell-subset">Analysis of T-cell subset<a class="anchor" aria-label="anchor" href="#analysis-of-t-cell-subset"></a>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sce.tcell</span> <span class="op">&lt;-</span> <span class="va">sce.filtered.nonartifact</span><span class="op">[</span>, <span class="va">sce.filtered.nonartifact</span><span class="op">$</span><span class="va">label</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">9</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<div class="section level5">
<h5 id="rna-only-clustering-of-t-cells">RNA only clustering of T-cells<a class="anchor" aria-label="anchor" href="#rna-only-clustering-of-t-cells"></a>
</h5>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sce.tcell</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scuttle/man/logNormCounts.html" class="external-link">logNormCounts</a></span><span class="op">(</span><span class="va">sce.tcell</span><span class="op">)</span></span>
<span><span class="va">dec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scran/man/modelGeneVar.html" class="external-link">modelGeneVar</a></span><span class="op">(</span><span class="va">sce.tcell</span><span class="op">)</span></span>
<span><span class="va">hvgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scran/man/getTopHVGs.html" class="external-link">getTopHVGs</a></span><span class="op">(</span><span class="va">dec</span>, n <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span>
<span><span class="va">sce.tcell</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocSingular/man/runPCA.html" class="external-link">runPCA</a></span><span class="op">(</span><span class="va">sce.tcell</span>, subset_row <span class="op">=</span> <span class="va">hvgs</span><span class="op">)</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scran/man/buildSNNGraph.html" class="external-link">buildSNNGraph</a></span><span class="op">(</span><span class="va">sce.tcell</span>, use.dimred <span class="op">=</span> <span class="st">"PCA"</span><span class="op">)</span></span>
<span><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/cluster_louvain.html" class="external-link">cluster_louvain</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">$</span><span class="va">membership</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/colLabels.html" class="external-link">colLabels</a></span><span class="op">(</span><span class="va">sce.tcell</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span></span>
<span><span class="va">sce.tcell</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/runUMAP.html" class="external-link">runUMAP</a></span><span class="op">(</span><span class="va">sce.tcell</span>, dimred <span class="op">=</span> <span class="st">"PCA"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/plot_reddim.html" class="external-link">plotUMAP</a></span><span class="op">(</span><span class="va">sce.tcell</span>, colour_by <span class="op">=</span> <span class="st">"label"</span><span class="op">)</span></span></code></pre></div>
<p><img src="sce_rmams_tutorial_files/figure-html/plot_rna_t_cell-1.png" width="700"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">sce.raw</span>, <span class="st">"../inst/extdata/pbmc1k_sce_raw.rds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">sce.filtered</span>, <span class="st">"../inst/extdata/pbmc1k_sce_filtered.rds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">sce.filtered.nonartifact</span>, <span class="st">"../inst/extdata/pbmc1k_sce_filtered_nonartifact.rds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">sce.tcell</span>, <span class="st">"../inst/extdata/pbmc1k_sce_tcell.rds"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="step-2-creating-the-mams-object-from-the-singlecellexperiment-object">Step 2: Creating the MAMS object from the SingleCellExperiment
object<a class="anchor" aria-label="anchor" href="#step-2-creating-the-mams-object-from-the-singlecellexperiment-object"></a>
</h3>
<div class="section level4">
<h4 id="loading-data">Loading data<a class="anchor" aria-label="anchor" href="#loading-data"></a>
</h4>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://single-cell-mams.github.io/rmams/">rmams</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get the file paths of sce objects</span></span>
<span></span>
<span><span class="va">file_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"../inst/extdata/pbmc1k_sce_raw.rds"</span>, <span class="st">"../inst/extdata/pbmc1k_sce_filtered.rds"</span>, <span class="st">"../inst/extdata/pbmc1k_sce_filtered_nonartifact.rds"</span>, <span class="st">"../inst/extdata/pbmc1k_sce_tcell.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get the names of these objects </span></span>
<span><span class="va">file_names</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"\\.rds$"</span>, replacement <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/path.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">file_paths</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># save the seurat objects onto the object_list by reading the object from file path.</span></span>
<span><span class="va">object_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">file_paths</span>, <span class="va">readRDS</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># name the list objects using previously generated file_names.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">object_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">file_names</span></span>
<span></span>
<span><span class="co"># define the type of each subset</span></span>
<span><span class="va">observational_subsets</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"raw"</span>, <span class="st">"filtered"</span>,<span class="st">"nonartifact"</span>,<span class="st">"subset"</span><span class="op">)</span></span>
<span><span class="va">datasetid</span> <span class="op">=</span> <span class="st">"PBMC1K"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="create-mams-object">Create MAMS object<a class="anchor" aria-label="anchor" href="#create-mams-object"></a>
</h4>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/convert_SCE_to_MAMS.html">convert_SCE_to_MAMS</a></span><span class="op">(</span><span class="va">object_list</span>,<span class="va">observational_subsets</span>,<span class="va">datasetid</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="accessing-data">Accessing data<a class="anchor" aria-label="anchor" href="#accessing-data"></a>
</h4>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the dataset_id from the first fom</span></span>
<span><span class="fu"><a href="../reference/FOM-get-generic.html">fom</a></span><span class="op">(</span><span class="va">result</span>,<span class="st">"fom1"</span>,<span class="st">"dataset_id"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "PBMC1K"</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="step-3-validating-mams-object">Step 3: Validating MAMS object<a class="anchor" aria-label="anchor" href="#step-3-validating-mams-object"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/FOM-get-generic.html">fom</a></span><span class="op">(</span><span class="va">result</span>,<span class="st">"fom1"</span>,<span class="st">"dataset_id"</span><span class="op">)</span> <span class="op">&lt;-</span><span class="st">""</span></span>
<span><span class="fu"><a href="../reference/check_MAMS.html">check_MAMS</a></span><span class="op">(</span>mams_object <span class="op">=</span> <span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Please use the setter functions to add the missing field information for the following slots: </span></span>
<span><span class="co">#&gt; (Ex. If missing 'filepath' for fom1, then 'fom(mams = mams_object, fom_id = 'fom1', key = 'filepath') &lt;- ...')</span></span>
<span><span class="co">#&gt; :</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result): fom1 is missing the fields:</span></span>
<span><span class="co">#&gt;  [1] "representation_description"      "obs_unit"                       </span></span>
<span><span class="co">#&gt;  [3] "processing"                      "processing_description"         </span></span>
<span><span class="co">#&gt;  [5] "analyte_description"             "obs_subset"                     </span></span>
<span><span class="co">#&gt;  [7] "obs_subset_description"          "feature_subset"                 </span></span>
<span><span class="co">#&gt;  [9] "feature_subset_description"      "record_id"                      </span></span>
<span><span class="co">#&gt; [11] "parent_id"                       "parent_relationship"            </span></span>
<span><span class="co">#&gt; [13] "parent_relationship_description" "fid"                            </span></span>
<span><span class="co">#&gt; [15] "obs"                             "fea"</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result):</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result): fom2 is missing the fields:</span></span>
<span><span class="co">#&gt;  [1] "representation_description"      "obs_unit"                       </span></span>
<span><span class="co">#&gt;  [3] "processing"                      "processing_description"         </span></span>
<span><span class="co">#&gt;  [5] "analyte_description"             "obs_subset"                     </span></span>
<span><span class="co">#&gt;  [7] "obs_subset_description"          "feature_subset"                 </span></span>
<span><span class="co">#&gt;  [9] "feature_subset_description"      "record_id"                      </span></span>
<span><span class="co">#&gt; [11] "parent_id"                       "parent_relationship"            </span></span>
<span><span class="co">#&gt; [13] "parent_relationship_description" "fid"                            </span></span>
<span><span class="co">#&gt; [15] "obs"                             "fea"</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result):</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result): fom3 is missing the fields:</span></span>
<span><span class="co">#&gt;  [1] "representation_description"      "obs_unit"                       </span></span>
<span><span class="co">#&gt;  [3] "processing"                      "processing_description"         </span></span>
<span><span class="co">#&gt;  [5] "analyte_description"             "obs_subset"                     </span></span>
<span><span class="co">#&gt;  [7] "obs_subset_description"          "feature_subset"                 </span></span>
<span><span class="co">#&gt;  [9] "feature_subset_description"      "record_id"                      </span></span>
<span><span class="co">#&gt; [11] "parent_id"                       "parent_relationship"            </span></span>
<span><span class="co">#&gt; [13] "parent_relationship_description" "fid"                            </span></span>
<span><span class="co">#&gt; [15] "obs"                             "fea"</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result):</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result): fom4 is missing the fields:</span></span>
<span><span class="co">#&gt;  [1] "representation_description"      "obs_unit"                       </span></span>
<span><span class="co">#&gt;  [3] "processing_description"          "analyte_description"            </span></span>
<span><span class="co">#&gt;  [5] "obs_subset"                      "obs_subset_description"         </span></span>
<span><span class="co">#&gt;  [7] "feature_subset"                  "feature_subset_description"     </span></span>
<span><span class="co">#&gt;  [9] "record_id"                       "parent_id"                      </span></span>
<span><span class="co">#&gt; [11] "parent_relationship"             "parent_relationship_description"</span></span>
<span><span class="co">#&gt; [13] "fid"                             "obs"                            </span></span>
<span><span class="co">#&gt; [15] "fea"</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result):</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result): fom5 is missing the fields:</span></span>
<span><span class="co">#&gt;  [1] "representation_description"      "obs_unit"                       </span></span>
<span><span class="co">#&gt;  [3] "processing_description"          "analyte_description"            </span></span>
<span><span class="co">#&gt;  [5] "obs_subset_description"          "feature_subset"                 </span></span>
<span><span class="co">#&gt;  [7] "feature_subset_description"      "record_id"                      </span></span>
<span><span class="co">#&gt;  [9] "parent_id"                       "parent_relationship"            </span></span>
<span><span class="co">#&gt; [11] "parent_relationship_description" "fid"                            </span></span>
<span><span class="co">#&gt; [13] "obs"                             "fea"</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result):</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result): fom6 is missing the fields:</span></span>
<span><span class="co">#&gt;  [1] "representation_description"      "obs_unit"                       </span></span>
<span><span class="co">#&gt;  [3] "processing_description"          "analyte_description"            </span></span>
<span><span class="co">#&gt;  [5] "obs_subset_description"          "feature_subset"                 </span></span>
<span><span class="co">#&gt;  [7] "feature_subset_description"      "record_id"                      </span></span>
<span><span class="co">#&gt;  [9] "parent_id"                       "parent_relationship"            </span></span>
<span><span class="co">#&gt; [11] "parent_relationship_description" "fid"                            </span></span>
<span><span class="co">#&gt; [13] "obs"                             "fea"</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result):</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result): fom7 is missing the fields:</span></span>
<span><span class="co">#&gt;  [1] "representation_description"      "obs_unit"                       </span></span>
<span><span class="co">#&gt;  [3] "processing"                      "processing_description"         </span></span>
<span><span class="co">#&gt;  [5] "analyte_description"             "obs_subset"                     </span></span>
<span><span class="co">#&gt;  [7] "obs_subset_description"          "feature_subset"                 </span></span>
<span><span class="co">#&gt;  [9] "feature_subset_description"      "record_id"                      </span></span>
<span><span class="co">#&gt; [11] "parent_id"                       "parent_relationship"            </span></span>
<span><span class="co">#&gt; [13] "parent_relationship_description" "fid"                            </span></span>
<span><span class="co">#&gt; [15] "obs"                             "fea"</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result):</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result): fom8 is missing the fields:</span></span>
<span><span class="co">#&gt;  [1] "representation_description"      "obs_unit"                       </span></span>
<span><span class="co">#&gt;  [3] "processing_description"          "analyte_description"            </span></span>
<span><span class="co">#&gt;  [5] "obs_subset"                      "obs_subset_description"         </span></span>
<span><span class="co">#&gt;  [7] "feature_subset"                  "feature_subset_description"     </span></span>
<span><span class="co">#&gt;  [9] "record_id"                       "parent_id"                      </span></span>
<span><span class="co">#&gt; [11] "parent_relationship"             "parent_relationship_description"</span></span>
<span><span class="co">#&gt; [13] "fid"                             "obs"                            </span></span>
<span><span class="co">#&gt; [15] "fea"</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result):</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result): fom9 is missing the fields:</span></span>
<span><span class="co">#&gt;  [1] "representation_description"      "obs_unit"                       </span></span>
<span><span class="co">#&gt;  [3] "processing_description"          "analyte_description"            </span></span>
<span><span class="co">#&gt;  [5] "obs_subset_description"          "feature_subset"                 </span></span>
<span><span class="co">#&gt;  [7] "feature_subset_description"      "record_id"                      </span></span>
<span><span class="co">#&gt;  [9] "parent_id"                       "parent_relationship"            </span></span>
<span><span class="co">#&gt; [11] "parent_relationship_description" "fid"                            </span></span>
<span><span class="co">#&gt; [13] "obs"                             "fea"</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result):</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result): fom10 is missing the fields:</span></span>
<span><span class="co">#&gt;  [1] "representation_description"      "obs_unit"                       </span></span>
<span><span class="co">#&gt;  [3] "processing_description"          "analyte_description"            </span></span>
<span><span class="co">#&gt;  [5] "obs_subset_description"          "feature_subset"                 </span></span>
<span><span class="co">#&gt;  [7] "feature_subset_description"      "record_id"                      </span></span>
<span><span class="co">#&gt;  [9] "parent_id"                       "parent_relationship"            </span></span>
<span><span class="co">#&gt; [11] "parent_relationship_description" "fid"                            </span></span>
<span><span class="co">#&gt; [13] "obs"                             "fea"</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result):</span></span>
<span><span class="co">#&gt; Error: Please use the setter functions to add the missing field information for the following slots: </span></span>
<span><span class="co">#&gt; (Ex. If missing 'filepath' for fom1, then 'fom(mams = mams_object, fom_id = 'fom1', key = 'filepath') &lt;- ...')</span></span>
<span><span class="co">#&gt; :</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result): fom1 is missing the fields:</span></span>
<span><span class="co">#&gt; [1] "dataset_id"</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result):</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result): The following slot is empty: ONG</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result): The following slot is empty: FEA</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result): The following slot is empty: OBS</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result): The following slot is empty: FID</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result): The following slot is empty: OID</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result): The following slot is empty: REC</span></span>
<span><span class="co">#&gt; Warning in check_MAMS(mams_object = result): The following slot is empty: FNG</span></span></code></pre></div>
<div class="section level4">
<h4 id="step-4-updating-fields-manually">Step 4: Updating fields manually<a class="anchor" aria-label="anchor" href="#step-4-updating-fields-manually"></a>
</h4>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add dataset id</span></span>
<span><span class="fu"><a href="../reference/FOM-get-generic.html">fom</a></span><span class="op">(</span><span class="va">result</span>,<span class="st">"fom1"</span>,<span class="st">"dataset_id"</span><span class="op">)</span> <span class="op">&lt;-</span><span class="st">"PBMC1K"</span></span>
<span></span>
<span><span class="co"># by default all reduced dimensions are annotated as Reductions, but UMAP can be better reflected as Embedding</span></span>
<span><span class="fu"><a href="../reference/FOM-get-generic.html">fom</a></span><span class="op">(</span><span class="va">result</span>, <span class="st">"fom6"</span>, <span class="st">"processing"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Embedding"</span></span></code></pre></div>
<p>we can add some commands as well</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># command example </span></span>
<span><span class="co"># show two examples, annotate counts matrix and annotate one of reducedDims, commands, params </span></span>
<span><span class="va">record_id</span> <span class="op">&lt;-</span> <span class="st">"CellRanger.count"</span></span>
<span><span class="va">record_package_name</span><span class="op">&lt;-</span> <span class="st">"CellRanger"</span></span>
<span><span class="va">record_function_name</span><span class="op">&lt;-</span> <span class="st">"count"</span></span>
<span><span class="va">record_package_version</span><span class="op">&lt;-</span> <span class="st">"unknown"</span></span>
<span></span>
<span><span class="va">result</span><span class="op">@</span><span class="va">REC</span><span class="op">[[</span><span class="va">record_id</span><span class="op">]</span><span class="op">]</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_REC_object.html">create_REC_object</a></span><span class="op">(</span>record_package_name <span class="op">=</span> <span class="va">record_package_name</span>,</span>
<span>                                          record_function_name <span class="op">=</span> <span class="va">record_function_name</span>,</span>
<span>                                          record_package_version <span class="op">=</span> <span class="va">record_package_version</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="storing-mams-in-input">storing mams in input<a class="anchor" aria-label="anchor" href="#storing-mams-in-input"></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">metadata</span><span class="op">(</span><span class="va">sce.filtered.nonartifact</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#store directly? json to list? make new function like json that converts to list of lists</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-6-saving-mams-object-to-json">Step 6: Saving MAMS object to JSON<a class="anchor" aria-label="anchor" href="#step-6-saving-mams-object-to-json"></a>
</h3>
<div class="section level4">
<h4 id="here-we-show-how-you-can-convert-the-mams-object-to-the-json-format-for-export--mams-and-json-formats-are-interchangeable-">Here we show how you can convert the MAMS object to the JSON format
for export. MAMS and JSON formats are interchangeable.<a class="anchor" aria-label="anchor" href="#here-we-show-how-you-can-convert-the-mams-object-to-the-json-format-for-export--mams-and-json-formats-are-interchangeable-"></a>
</h4>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/write_MAMS_to_output.html">write_MAMS_to_output</a></span><span class="op">(</span>MAMS<span class="op">=</span><span class="va">result</span>, filepath <span class="op">=</span> <span class="st">"../inst/extdata/pbmc1k_rna_sce_mams.JSON"</span>,format <span class="op">=</span> <span class="st">"JSON"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="step-5-saving-mams-as-yaml">Step 5: Saving MAMS as YAML<a class="anchor" aria-label="anchor" href="#step-5-saving-mams-as-yaml"></a>
</h3>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/write_MAMS_to_output.html">write_MAMS_to_output</a></span><span class="op">(</span>MAMS<span class="op">=</span><span class="va">result</span>, filepath <span class="op">=</span> <span class="st">"../inst/extdata/pbmc1k_rna_sce_mams.yml"</span>,format <span class="op">=</span> <span class="st">"YAML"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Irzam Sarfraz, Ming Liu, Salam Alabdullatif, Yusuke Koga, Amulya Shastry, Natasha Gurevich, Junxiang Xu, Tomoki Motegi, Jingwen Xu, Tao Guo, Joshua David Campbell.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
